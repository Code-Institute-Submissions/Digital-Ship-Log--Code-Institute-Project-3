<!-- @format -->

{% extends 'base.html' %} {% block pageTitle %}<title>A Page title</title>{%endblock %} 

{% block main %}

<div class="row mx-auto no-gutters">
  <div class="col-md-12 col-lg-6">
    <!-- #region STATUS WINDOW ======================================================= -->
    {% for user in users %}
    <div class="status-window">
      <h2>Welcome {{user.first_name}}</h2>
      <p>CURRENT ACTIVITY: <i class="{{ activity.activity_icon }}"></i> </i><strong>{{activity.activity_name}}</strong></p>
      <p><strong>Last Logentry</strong> - 9 July, 2020 - 11:56</p>
      <hr />
    </div>
    {% endfor %}
    <!--#endregion-->
    <!-- #region DROPDOWN BUTTONS ==================================================== -->
    <div>
      <span class="dropdown">
        <button
          class="btn btn-light btn-sm dropdown-toggle"
          type="button"
          id="dropdownMenuButton"
          data-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Change Activity
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          {% for option in options %}
          <a
            class="dropdown-item"
            href="{{ url_for('change_activity', new_activity=option.set_to_status)}}"
            >{{option.opt_name}}</a
          >
          {% endfor %}
        </div>
      </span>
      <!-- ==== ADD NEW LOG ENTRY Dropdown =========================== -->
      <span class="dropdown">
        <button
          class="btn btn-light btn-sm dropdown-toggle"
          type="button"
          id="dropdownMenuButton"
          data-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Add new log entry
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <a class="dropdown-item" href="#">New Log in open Journey</a>
          <a class="dropdown-item" href="#">New Log (independent)</a>
          <a class="dropdown-item" href="#">New Service note</a>
          <a class="dropdown-item" href="#Â¤">Upload image</a>
        </div>
      </span>
    </div>
    <!-- #endregion -->
    <!-- #region LOG HEADERS HEAD - Accordion Level 1 - HEAD ========================= -->
    <div class="be-accordion" id="accordion1">
      {% for log_header in log_headers %}
      <div class="card bg-transparent border-0">
        <!-- **** Log headers head (Accordion 1 head) **** -->
        <div class="card-header bg-transparent" id="heading{{ loop.index }}">
          
          {% if log_header.is_active or loop.index == 1%}
            {% set is_expanded = "true" %}
            {% set open_or_collapsed = "collapse show" %}
          {% else %}
            {% set is_expanded = "true" %}
            {% set open_or_collapsed = "collapse show" %}
          {% endif %}
          
          <h3>
            <a
              data-toggle="collapse"
              data-target="#collapse{{ loop.index }}"
              aria-expanded="{{ is_expanded }}"
              aria-controls="collapse{{ loop.index }}"
            >
            {{ log_header.type }}: {{ log_header.title }}
            </a>
          </h3>
        </div>
        <!-- #endregion -->
    <!-- #region LOG HEADERS BODY - Accordion Level 1 - BODY ========================= -->
        <!-- **** Log headers body (Accordion 1 body also containing log entries) **** -->
        <div
        id="collapse{{ loop.index }}"
        class="{{ open_or_collapsed }}"
        aria-labelledby="heading{{ loop.index }}"
        data-parent="#accordion1"
        >       
          <div class="card-body px-1 pt-0 pb-5">
            {% if log_header.type == "Journey" %}
            <p>
              STARTED: {{ log_header.start_datetime.strftime("%Y-%m-%d, %H:%M") }} - 
              {% if log_header.is_active %}
                Ongoing <i class="fas fa-hourglass-half"></i>
              {% else %}
              ENDED: {{ log_header.end_datetime.strftime("%Y-%m-%d, %H:%M") }} <i class="fas fa-flag-checkered"></i>
              {% endif %}
              <br>
              FROM: 
              {% if log_header.start_location %}
                {{ log_header.start_location }} 
              {% else %}
                n/a
              {% endif %}
               - TO: 
               {% if log_header.end_location %}
               {{ log_header.end_location }} 
                {% else %}
               n/a
              {% endif %}
              - Distance: 
              {% if log_header.distance %}
              {{ log_header.distance }} 
              {% else %}
               n/a
              {% endif %}
              <br>
              DESCRIPTION: {{ log_header.description}}
            </p>
            <!-- **** LOG HEADER BODY SERVICE **** -->
            {% elif log_header.type == "Service" %}
            <p>Service record header</p>
            {% else %}
            <p>No Log Header Set!</p>
            {% endif %}


            {% if log_header.is_active %}
              <a 
              href="{{ url_for('newlog', journey_id=log_header._id)}}" 
              class="btn btn-secondary btn-sm" 
              role="button" 
              aria-pressed="true">
              Add new log
              </a>
            {% endif %}
            <hr />
            
            <!-- #endregion -->
            
    <!-- #region LOG ENTRIES - Accordion Level 2 =========================== -->
            <div class="be-accordion" id="accordion2">
              {% set rowloop = loop %}
              {% for log in logs %}
              {% if log.head_id == log_header._id %}
              <div class="card bg-transparent border-0">
                <!-- Accordion 2 header -->  
                <div class="card-header bg-transparent log-entry-head" id="heading{{ rowloop.index }}_{{ loop.index }}">
                      <h4>
                          <a 
                          data-toggle="collapse" 
                          data-target="#collapse{{ rowloop.index }}_{{ loop.index }}"
                          aria-expanded="false" 
                          aria-controls="collapse{{ rowloop.index }}_{{ loop.index }}">
                          {{ log.title }} - {{ log.datetime.strftime("%Y-%m-%d, %H:%M") }}
                          </a>
                      </h4>
                  </div>
                  <!-- Accordion 2 body --> 
                  <div  id="collapse{{ rowloop.index }}_{{ loop.index }}" 
                        class="collapse" 
                        aria-labelledby="heading{{ rowloop.index }}_{{ loop.index }}" 
                        data-parent="#accordion2">
                      <div class="card-body">
                        <p>
                          <i class="fas fa-cloud-sun"></i> {{ log.weather }} | 
                          <i class="fas fa-temperature-low"></i> {{ log.temp }}&#8451; |
                          <i class="fas fa-cloud-upload-alt"></i> {{ log.air_pressure }}hPa |
                          <i class="fas fa-paper-plane"></i> {{ log.wind_dir }} |
                          <i class="fas fa-wind"></i> {{ log.wind_speed }}m/s 
                        </p>
                        <p>
                          {% if log.activity == "Engine" %}
                          <i class="fas fa-ship"></i> {{ log.activity }} 
                          {% elif log.activity == "Sail" %}
                          <i class="fab fa-atlassian"></i>
                          {% elif log.activity == "Moored" %}
                          <i class="fas fa-rupee-sign"></i>
                          {% elif log.activity == "Anchored" %}
                          <i class="fas fa-anchor"></i>
                          {% else %}
                          <i class="fas fa-question-circle"></i>
                          {% endif %} {{ log.activity }} |
                          <i class="fas fa-compass"></i> {{ log.heading }}&#176; |
                          <i class="fas fa-tachometer-alt"></i> {{ log.speed }}Kn |
                        </p>
                        <p>
                          <i class="fas fa-map-marked-alt"></i> {{ log.location }} |
                          {% for pos in log.position %}
                          <i class="fas fa-arrows-alt-v"></i> {{ pos.latitude }}&#176; |
                          <i class="fas fa-arrows-alt-h"></i> {{ pos.longitude }}&#176;
                          {% endfor %}
                        </p>
                        <p>{{ log.note }}</p>
                          {% if log.imagefile != "none" %}
                          <figure>
                            <img class="img-fluid rounded" src="{{ log.img_url }}" alt="{{ log.img_cap }}">
                            <figcaption>{{ log.img_cap }}</figcaption>
                          {% endif %}
                          </figure>
                      </div> <!-- END Card body Accordion 2-->
                  </div> <!-- END Collapsible Accordion 2 -->
              </div> <!-- END Card Accordion 2 -->
              {% endif %} 
              {% endfor %} 
            </div> <!-- END ACCORDION 2 -->
          </div><!-- END Card body Accordion 2 -->
        </div><!-- END collapsible Accordion 1 -->
      </div> <!-- END Card Aaccordion 1 -->
      {% endfor %} 
    </div> <!-- END Aaccordion 1 -->
  </div> <!-- END Bootstrap col -->

  <!-- ==== MAP ========================================================== -->
  <div class="col-md-12 col-lg-6 map-box">
    <img
      class="img-fluid dummy_map_img"
      src="../static/img/dummy_map_800x800.png"
      alt="A dummy map from Google"
    />
  </div>
</div>

{% endblock %}
