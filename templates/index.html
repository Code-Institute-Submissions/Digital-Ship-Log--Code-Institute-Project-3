<!-- @format -->

{% extends 'base.html' %} {% block pageTitle %}<title>A Page title</title>{%endblock %} 

{% block main %}

<div class="row mx-auto no-gutters">
  <div class="col-md-12 col-lg-6 status-box">
    <!-- ==== STATUS WINDOW ==================================== -->
    {% for user in users %}
    <h4>Welcome {{user.first_name}}</h4>
    <p>CURRENT ACTIVITY: <strong>{{activity}}</strong></p>
    <p><strong>Last Logentry</strong> - 9 July, 2020 - 11:56</p>
    <hr />
    {% endfor %}
    <!-- ==== ACTIVITY SET Dropdown =========================== -->
    <div>
      <span class="dropdown">
        <button
          class="btn btn-light btn-sm dropdown-toggle"
          type="button"
          id="dropdownMenuButton"
          data-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Change Activity
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          {% for option in options %}
          <a
            class="dropdown-item"
            href="{{ url_for('change_activity', new_activity=option.set_to_status)}}"
            >{{option.opt_name}}</a
          >
          {% endfor %}
        </div>
      </span>
      <!-- ==== ADD NEW LOG ENTRY Dropdown =========================== -->
      <span class="dropdown">
        <button
          class="btn btn-light btn-sm dropdown-toggle"
          type="button"
          id="dropdownMenuButton"
          data-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Add new log entry
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <a class="dropdown-item" href="#">New Log in open Journey</a>
          <a class="dropdown-item" href="#">New Log (independent)</a>
          <a class="dropdown-item" href="#">New Service note</a>
        </div>
      </span>
    </div>
    <!-- ==== LOG HEADERS - Accordion Level 1 =========================== -->
    <div class="be-accordion" id="accordion1">
      {% for log_header in log_headers %}
      <div class="card bg-transparent border-0">
        <div class="card-header bg-transparent border-0 p-0" id="heading{{ loop.index }}">
          <h5>
            <a
              class="display-7"
              data-toggle="collapse"
              data-target="#collapse{{ loop.index }}"
              aria-expanded="false"
              aria-controls="collapse{{ loop.index }}"
            >
            {{ log_header.type }}: {{ log_header.title }}
            </a>
          </h5>
        </div>
        <div
          id="collapse{{ loop.index }}"
          class="collapse"
          aria-labelledby="heading{{ loop.index }}"
          data-parent="#accordion1"
        >
          <div class="card-body px-1 pt-0 pb-5">
            {% if log_header.type == "Journey" %}
            <p>
              STARTED: {{ log_header.start_datetime.strftime("%Y-%m-%d, %H:%M") }} - 
              {% if log_header.is_active %}
                Ongoing
              {% else %}
              ENDED: {{ log_header.end_datetime.strftime("%Y-%m-%d, %H:%M") }}
              {% endif %}
              <br>
              FROM: {{ log_header.start_location }} - TO: {{ log_header.end_location }} - Distance: {{
                log_header.distance }}
              <br>
              DESCRIPTION: {{ log_header.description}}
            </p>
            {% elif log_header.type == "Service" %}
            <p>Service record header</p>
            {% else %}
            <p>No Log Header Set!</p>
            {% endif %}
            {% if log_header.is_active %}
              <a 
              href="{{ url_for('newlog', journey_id=log_header._id)}}" 
              class="btn btn-secondary btn-sm" 
              role="button" 
              aria-pressed="true">
              Add new log
              </a>
            {% endif %}
            <hr />
            <p>Header Id: {{ log_header._id }}</p>
            {% for log in logs %}
              {% if log.head_id ==  log_header._id %}
              <h6>{{ log.title }} - {{ log.datetime.strftime("%Y-%m-%d, %H:%M") }}</h6>
              <p>{{ log.note }}</p>
              <p>Log head_id: {{ log.head_id }}</p>
              <p>Header Id: {{ log_header._id }}</p>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- ==== MAP ========================================================== -->
  <div class="col-md-12 col-lg-6 map-box">
    <img
      class="img-fluid dummy_map_img"
      src="../static/img/dummy_map_800x800.png"
      alt="A dummy map from Google"
    />
  </div>
</div>

{% endblock %}
